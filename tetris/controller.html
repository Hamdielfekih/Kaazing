<html>
<head>

<title>Controller</title>

<style type="text/css">
body {
  background-color: #74798C;
  margin: 0;
  padding: 0;
  overflow: hidden;
}

.button {
  background-color: white;
  border-radius: 6px;
  position: absolute;
}
 
.button > div {
  background-color: #CA070D;
  margin-left: auto;
  margin-right: auto;
}
  
.direction {
  background-color: rgba( 255, 0, 0, 0.20 );
  border: solid 1px red;
  position: absolute;
}
  
.pad {
  background-image: url( pad.svg );
  background-position: center;
  background-repeat: no-repeat;
  background-size: contain;
  position: absolute;
}
  
.surface {
  background-color: black;
  border-radius: 6px;
  position: absolute;
}
</style>  
  
<script src="gateway.js" type="text/javascript"></script>

<script type="text/javascript">
var KAAZING_ID = 'd71dfe3a-818e-4f9c-8af6-fb81649d9a6d';
var MOVE_DOWN = 'down';  
var MOVE_LEFT_PRESS = 'left_press';  
var MOVE_LEFT_RELEASE = 'left_release';    
var MOVE_RIGHT = 'right';  
var MOVE_UP = 'up';
var TETRIS = 'tetris_topic';

var kaazing = null;  
  
function layout_horizontal()
{
  var buttons = null;
  var direction = null;
  var pad = null;
  var surface = null;
  
  surface = document.querySelector( '.surface' );
  surface.style.height = Math.round( window.innerHeight * 0.75 ) + 'px'; // 330 / 440
  surface.style.width = Math.round( window.innerWidth * 0.95 ) + 'px'; // 940 / 990
  surface.style.left = Math.round( ( window.innerWidth - surface.clientWidth ) / 2 ) + 'px';
  surface.style.top = Math.round( window.innerHeight * 0.15 ) + 'px'; // 70 / 440  
  
  buttons = document.querySelectorAll( '.button' );
  
  for( var b = 0; b < buttons.length; b++ )
  {
    buttons[b].style.height = Math.round( window.innerHeight * 0.25 ) + 'px'; // 115 / 440
    buttons[b].style.width = Math.round( window.innerHeight * 0.25 ) + 'px';   
    buttons[b].style.bottom = Math.round( window.innerHeight * 0.20 ) + 'px'; // 75 / 400
    buttons[b].style.right = ( Math.round( window.innerWidth * 0.10 ) + ( b * ( buttons[b].clientWidth + ( window.innerWidth * 0.02 ) ) ) ) + 'px'; // 90 / 990 && 15 / 990 
    
    buttons[b].children[0].style.width = Math.round( buttons[b].clientWidth * 0.75 ) + 'px'; // 85 /116
    buttons[b].children[0].style.height = Math.round( buttons[b].clientWidth * 0.75 ) + 'px';
    buttons[b].children[0].style.marginTop = Math.round( ( buttons[b].clientHeight - buttons[b].children[0].clientHeight ) / 2 ) + 'px';
    buttons[b].children[0].style.borderRadius = buttons[b].children[0].clientWidth + 'px';
  }    
  
  pad = document.querySelector( '.pad' );
  pad.style.width = Math.round( window.innerWidth * 0.20 ) + 'px'; // 200 / 990
  pad.style.height = Math.round( window.innerWidth * 0.20 ) + 'px';
  pad.style.left = Math.round( window.innerWidth * 0.10 ) + 'px'; // 75 / 990
  pad.style.bottom = Math.round( window.innerHeight * 0.20 ) + 'px' // 85 / 440
  
  // Up
  pad.children[0].style.width = Math.round( pad.clientWidth * 0.38 ) + 'px';
  pad.children[0].style.height = Math.round( pad.clientWidth * 0.30 ) + 'px';
  pad.children[0].style.left = Math.round( pad.clientWidth * 0.30 ) + 'px';
  
  // Left
  pad.children[1].style.width = Math.round( pad.clientWidth * 0.30 ) + 'px';
  pad.children[1].style.height = Math.round( pad.clientWidth * 0.38 ) + 'px';
  pad.children[1].style.top = Math.round( pad.clientWidth * 0.30 ) + 'px';  
  
  // Down
  pad.children[2].style.width = Math.round( pad.clientWidth * 0.38 ) + 'px';
  pad.children[2].style.height = Math.round( pad.clientWidth * 0.30 ) + 'px';
  pad.children[2].style.left = Math.round( pad.clientWidth * 0.30 ) + 'px';  
  pad.children[2].style.bottom = 0;    
  
  // Right
  pad.children[3].style.width = Math.round( pad.clientWidth * 0.30 ) + 'px';
  pad.children[3].style.height = Math.round( pad.clientWidth * 0.38 ) + 'px';
  pad.children[3].style.top = Math.round( pad.clientWidth * 0.30 ) + 'px';  
  pad.children[3].style.right = 0;      
}
  
function layout_vertical()
{
    
}

function send_command( command )
{
  kaazing.publish( TETRIS, JSON.stringify( {
    command: command  
  } ) );
}
  
function do_click_down()
{
  console.log( 'Down.' );
  send_command( MOVE_DOWN );
}
 
function do_left_down()
{
  console.log( 'Left down.' );  
  
  send_command( {
    command: 'left',
    type: 'down'
  } );
}
  
function do_left_up()
{
  console.log( 'Left up.' );  
  
  send_command( {
    command: 'left',
    type: 'up'
  } );
}  
  
function do_click_right()
{
  console.log( 'Right.' );  
  send_command( MOVE_RIGHT );
}
  
function do_click_up()
{
  console.log( 'Up.' );
  send_command( MOVE_UP );
}  
  
function do_window_load()
{
  var pad = null;
  
  kaazing = Gateway.connect( KAAZING_ID );
  
  // Direction pad
  pad = document.querySelector( '.pad' );
  pad.children[0].addEventListener( 'click', do_click_up );
  pad.children[1].addEventListener( 'mousedown', do_left_down );
  pad.children[1].addEventListener( 'mouseup', do_left_up );  
  pad.children[2].addEventListener( 'click', do_click_down );
  pad.children[3].addEventListener( 'click', do_click_right );    
  
  do_window_resize();
}
  
function do_window_resize()
{  
  if( window.innerWidth > window.innerHeight )
  {
    layout_horizontal();  
  } else {
    layout_vertical();  
  }
}
  
window.addEventListener( 'load', do_window_load );  
window.addEventListener( 'resize', do_window_resize );    
</script>  
  
</head>
<body>

<div class="surface"></div>

<div class="pad">
  <div class="direction up"></div>
  <div class="direction left"></div>  
  <div class="direction down"></div>    
  <div class="direction right"></div>      
</div>  
  
<div class="button">
  <div></div>
</div>
  
<div class="button">
  <div></div>
</div>  
  
</body>
</html>
